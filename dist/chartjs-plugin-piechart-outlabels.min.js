/*!
 * @energiency/chartjs-plugin-piechart-outlabels v1.3.2
 * http://www.chartjs.org
 * (c) 2017-2024 @energiency/chartjs-plugin-piechart-outlabels contributors
 * Released under the MIT license
 */
!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t=function(){return t=Object.assign||function(t){for(var e,a=1,r=arguments.length;a<r;a++)for(var n in e=arguments[a])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},t.apply(this,arguments)},e=function(t,e,a){if(a||2===arguments.length)for(var r,n=0,o=e.length;n<o;n++)!r&&n in e||(r||(r=Array.prototype.slice.call(e,0,n)),r[n]=e[n]);return t.concat(r||Array.prototype.slice.call(e))},a=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("chart.js"),n=a(require("./custom-defaults")),o=require("./state"),i=a(require("./classes"));r.defaults.plugins.outlabels=n.default;var l=n.default.PLUGIN_KEY;function f(t){for(var e=0,a=t.length;e<a;e++){var r=t[e],n=r[l];n&&n.update(r,t,e)}}function u(a){var r,n,o,i,f,u=a._metasets[0].controller,d=u.getMeta(),s=function(e){for(var a={left:1/0,right:-1/0,top:1/0,bottom:-1/0},r=0,n=e.length;r<n;r++){var o=e[r][l];if(o&&o.labelRect){var i=o.labelRect,f=i.x,u=i.y,d=i.width,s=i.height;a.left=Math.min(a.left,f),a.right=Math.max(a.right,f+d),a.top=Math.min(a.top,u),a.bottom=Math.max(a.bottom,u+s)}}return t(t({},a),{width:a.right-a.left,height:a.bottom-a.top})}(d.data||[]),c=(r=s,n=a.chartArea,o=n.width,i=n.height,f=[(n.left-r.left)/o*2,(n.top-r.top)/i*2,(r.right-n.right)/o*2,(r.bottom-n.bottom)/i*2],1-Math.max.apply(Math,e([0],f,!1)));return!(!c||1===c)&&(u.outerRadius=u.outerRadius*c,u.innerRadius*=c,u.updateElements(d.data,0,d.data.length,"none"),!0)}exports.default={id:"outlabels",resize:function(t){(0,o.getState)(t).sizeChanged=!0},afterUpdate:function(t){var e=t._metasets[0].controller.getMeta().data||[],a=!1,r=e.length;for((0,o.getState)(t).fitting=!0;!a&&r-- >0;)f(e),a=!u(t);(0,o.getState)(t).fitting=!1},afterDatasetUpdate:function(t,e,a){var r,n,f,u,d,s,c=t.config.data.labels,h=t.data.datasets[e.index],g=function(t,e){var a=t.outlabels;return!1===a?null:(!0===a&&(a={}),Object.assign({},{},e,a))}(h,a),p=g&&g.display,b=e.meta.data||[],m=t.ctx;for(m.save(),s=0;s<b.length;++s){if(n=(r=b[s])[l],f=h.data[s]/e.meta.total,u=null,p&&r&&!r.hidden)try{d={chart:t,dataIndex:s,dataset:h,labels:c,datasetIndex:e.index,percent:f},u=new i.default.OutLabel(t,s,m,g,d)}catch(t){u=null}n&&u&&!(0,o.getState)(t).sizeChanged&&n.label===u.label&&n.encodedText===u.encodedText&&(u.offset=n.offset),r[l]=u}m.restore(),(0,o.getState)(t).sizeChanged=!1},afterDatasetDraw:function(t,e){var a=e.meta.data||[],r=t.ctx;(0,o.getState)(t).fitting||a.forEach((function(t,e){var n=t[l];n&&(n.update(t,a,e),n.draw(r))}))},afterDestroy:function(t){(0,o.removeState)(t)}}}));
